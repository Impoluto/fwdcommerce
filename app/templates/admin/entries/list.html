{extend "admin"}

{$channel_slug = $params.channel|default:$request.args.0}
{get $channel from "/channels/$channel_slug"}

{if $params.search}
	{if $channel.search_fields}
		{$search_params = []}
		{foreach $channel.search_fields as $field}
			{$search_params[$field|lower] = $params.search}
		{/foreach}
	{else}
		{$search_params = $params.search}
	{/if}
{/if}

{$order_field = $channel.order_field|default:"date_created"}
{$order_dir = $channel.order_dir|default:"desc"}

{$query = [
	channel_id => $channel.id,
	search => $search_params,
	where => $params.where,
	page => $params.page,
	order => "{$order_field} {$order_dir}"
]}

{get $entries from "/entries" $query}

<div class="list-container">
	<div class="list-header well">
		{if $channel.fields_by_id.categories.type == select}
			{$action_field = "categories"}
		{elseif $channel.fields_by_id.status.type == select}
			{$action_field = "status"}
		{/if}
		{if $action_field}
			{$actions = [all => [where => []]]}
			{foreach $channel.fields_by_id[$action_field].values as $key => $val}
				{$key = (($key|is_numeric) ? $val : $key)}
				{$actions[$key] = [where => ["{$action_field}" => $key]]}
			{/foreach}
		{/if}
		{render "search" for="entries" name=$channel_slug|spacify|lower action=$params.action actions=$actions count=$entries.count}
	</div>
	<ul class="list-results">
		{render "entries/results" channel=$channel entries=$entries}
	</ul>
</div>
